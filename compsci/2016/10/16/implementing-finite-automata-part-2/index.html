<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Implementing Finite Automata (Part 2)</title>
    <meta name="description" content="A web log. Mostly about computer science-y stuff. 
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://localhost:4000/compsci/2016/10/16/implementing-finite-automata-part-2/">
    
    <link rel="stylesheet" type="text/css" href="/css/katex.min.css">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Whatever</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Implementing Finite Automata (Part 2)</h1>
    <p class="post-meta">Oct 16, 2016</p>
  </header>

  <article class="post-content">
    <p>This is post number four in a <a href="/compsci/2016/03/28/theory-of-computation/">series</a> on Automata (in the formal languages / regex / parsing sense). It’s also part two of the “implementation-heavy” stuff, where we go into implementing automata for real and useful things. This one is more of a mix of theory and code, which I hope is more appealing than the previous post which were either one or the other. In <a href="/compsci/2016/10/03/implementing-finite-automata-part-1/">part one</a> I naively claimed that this would be two posts of implementation, but I’ve since found more to write about. Plus it allows me to postpone the hardest part of this implementation stuff (benchmarking).</p>

<p>This post will go into Infinite Sets, NFA-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">ε</span></span></span></span> and the transitive reachability closures over cyclic graphs.</p>

<h1 id="infinite-sets">Infinite Sets</h1>

<p>Something I ran into again at work recently is that regular languages can be finitely expressed with an automaton, even though they (usually) represent an infinite set of words. Every word in the language can be recognised by the finite automaton. So if our automata represent sets, we should be able to do set operations on them.</p>

<p>So we already know how to test if a word is in the language, by applying our automaton on it. Something new would be union, complement, difference or intersection. Let’s see how we can make sense of these</p>

<h2 id="union">Union</h2>

<p>Say you have two automata that can recognise words in their respective languages. The union of the two would recognise words from either language. So creating one NFA for the combined language out of the two only requires that you run the two “in parallel” and if either ends up in a final state you accept. Let’s try the naive way and merge the start states of the two automata:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Binary string DFA 1 Pages: 1 -->
<svg role="img" aria-label="Binary string DFA 1" width="411pt" height="78pt" viewBox="0.00 0.00 411.00 78.00">
<title>Binary string DFA 1</title>
<desc>digraph &quot;Binary string DFA 1&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q4 [shape=doublecircle, width=0.4];
start -&gt; q0;
q0 -&gt; q1 [label=&quot;1&quot;];
q1 -&gt; q2 [label=&quot;0&quot;];
q2 -&gt; q3 [label=&quot;0&quot;];
q3 -&gt; q3 [label=&quot;0&quot;];
q3 -&gt; q4 [label=&quot;1&quot;];
q4 -&gt; q4 [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 74)">
<title>Binary string DFA 1</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q0 -->
<g id="node3" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="56" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-14.8" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- start&#45;&gt;q0 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M18.6816,-18.5C21.5653,-18.5 24.6106,-18.5 27.6617,-18.5" />
<polygon fill="black" stroke="black" points="27.8306,-22.0001 37.8306,-18.5 27.8306,-15.0001 27.8306,-22.0001" />
</g>
<!-- q4 -->
<g id="node2" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="384.5" y="-14.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q4&#45;&gt;q4 -->
<g id="edge7" class="edge"><title>q4&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M377.412,-35.7739C375.965,-45.7309 378.328,-55 384.5,-55 388.454,-55 390.844,-51.196 391.672,-45.844" />
<polygon fill="black" stroke="black" points="395.171,-45.7445 391.588,-35.7739 388.171,-45.8027 395.171,-45.7445" />
<text text-anchor="middle" x="384.5" y="-58.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1 -->
<g id="node4" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="138" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-14.8" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge2" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M74.3588,-18.5C84.7029,-18.5 98.059,-18.5 109.779,-18.5" />
<polygon fill="black" stroke="black" points="109.95,-22.0001 119.95,-18.5 109.95,-15.0001 109.95,-22.0001" />
<text text-anchor="middle" x="97" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q2 -->
<g id="node5" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="220" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="220" y="-14.8" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge3" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M156.359,-18.5C166.703,-18.5 180.059,-18.5 191.779,-18.5" />
<polygon fill="black" stroke="black" points="191.95,-22.0001 201.95,-18.5 191.95,-15.0001 191.95,-22.0001" />
<text text-anchor="middle" x="179" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q3 -->
<g id="node6" class="node"><title>q3</title>
<ellipse fill="none" stroke="black" cx="302" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="302" y="-14.8" font-family="Times,serif" font-size="14.00">q3</text>
</g>
<!-- q2&#45;&gt;q3 -->
<g id="edge4" class="edge"><title>q2&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M238.359,-18.5C248.703,-18.5 262.059,-18.5 273.779,-18.5" />
<polygon fill="black" stroke="black" points="273.95,-22.0001 283.95,-18.5 273.95,-15.0001 273.95,-22.0001" />
<text text-anchor="middle" x="261" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q3&#45;&gt;q4 -->
<g id="edge6" class="edge"><title>q3&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M320.072,-18.5C330.39,-18.5 343.79,-18.5 355.614,-18.5" />
<polygon fill="black" stroke="black" points="355.896,-22.0001 365.896,-18.5 355.896,-15.0001 355.896,-22.0001" />
<text text-anchor="middle" x="343" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q3&#45;&gt;q3 -->
<g id="edge5" class="edge"><title>q3&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M294.969,-35.1641C293.406,-45.125 295.75,-54.5 302,-54.5 306.004,-54.5 308.405,-50.6525 309.202,-45.2682" />
<polygon fill="black" stroke="black" points="312.7,-45.1033 309.031,-35.1641 305.701,-45.2219 312.7,-45.1033" />
<text text-anchor="middle" x="302" y="-58.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Binary string DFA 2 Pages: 1 -->
<svg role="img" aria-label="Binary string DFA 2" width="411pt" height="78pt" viewBox="0.00 0.00 411.00 78.00">
<title>Binary string DFA 2</title>
<desc>digraph &quot;Binary string DFA 2&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q9 [shape=doublecircle, width=0.4];
start -&gt; q5;
q5 -&gt; q6 [label=&quot;0&quot;];
q6 -&gt; q7 [label=&quot;1&quot;];
q7 -&gt; q8 [label=&quot;0&quot;];
q8 -&gt; q8 [label=&quot;0&quot;];
q8 -&gt; q9 [label=&quot;1&quot;];
q9 -&gt; q9 [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 74)">
<title>Binary string DFA 2</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q5 -->
<g id="node3" class="node"><title>q5</title>
<ellipse fill="none" stroke="black" cx="56" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-14.8" font-family="Times,serif" font-size="14.00">q5</text>
</g>
<!-- start&#45;&gt;q5 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q5</title>
<path fill="none" stroke="black" d="M18.6816,-18.5C21.5653,-18.5 24.6106,-18.5 27.6617,-18.5" />
<polygon fill="black" stroke="black" points="27.8306,-22.0001 37.8306,-18.5 27.8306,-15.0001 27.8306,-22.0001" />
</g>
<!-- q9 -->
<g id="node2" class="node"><title>q9</title>
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="384.5" y="-14.8" font-family="Times,serif" font-size="14.00">q9</text>
</g>
<!-- q9&#45;&gt;q9 -->
<g id="edge7" class="edge"><title>q9&#45;&gt;q9</title>
<path fill="none" stroke="black" d="M377.412,-35.7739C375.965,-45.7309 378.328,-55 384.5,-55 388.454,-55 390.844,-51.196 391.672,-45.844" />
<polygon fill="black" stroke="black" points="395.171,-45.7445 391.588,-35.7739 388.171,-45.8027 395.171,-45.7445" />
<text text-anchor="middle" x="384.5" y="-58.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q6 -->
<g id="node4" class="node"><title>q6</title>
<ellipse fill="none" stroke="black" cx="138" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-14.8" font-family="Times,serif" font-size="14.00">q6</text>
</g>
<!-- q5&#45;&gt;q6 -->
<g id="edge2" class="edge"><title>q5&#45;&gt;q6</title>
<path fill="none" stroke="black" d="M74.3588,-18.5C84.7029,-18.5 98.059,-18.5 109.779,-18.5" />
<polygon fill="black" stroke="black" points="109.95,-22.0001 119.95,-18.5 109.95,-15.0001 109.95,-22.0001" />
<text text-anchor="middle" x="97" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q7 -->
<g id="node5" class="node"><title>q7</title>
<ellipse fill="none" stroke="black" cx="220" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="220" y="-14.8" font-family="Times,serif" font-size="14.00">q7</text>
</g>
<!-- q6&#45;&gt;q7 -->
<g id="edge3" class="edge"><title>q6&#45;&gt;q7</title>
<path fill="none" stroke="black" d="M156.359,-18.5C166.703,-18.5 180.059,-18.5 191.779,-18.5" />
<polygon fill="black" stroke="black" points="191.95,-22.0001 201.95,-18.5 191.95,-15.0001 191.95,-22.0001" />
<text text-anchor="middle" x="179" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q8 -->
<g id="node6" class="node"><title>q8</title>
<ellipse fill="none" stroke="black" cx="302" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="302" y="-14.8" font-family="Times,serif" font-size="14.00">q8</text>
</g>
<!-- q7&#45;&gt;q8 -->
<g id="edge4" class="edge"><title>q7&#45;&gt;q8</title>
<path fill="none" stroke="black" d="M238.359,-18.5C248.703,-18.5 262.059,-18.5 273.779,-18.5" />
<polygon fill="black" stroke="black" points="273.95,-22.0001 283.95,-18.5 273.95,-15.0001 273.95,-22.0001" />
<text text-anchor="middle" x="261" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q8&#45;&gt;q9 -->
<g id="edge6" class="edge"><title>q8&#45;&gt;q9</title>
<path fill="none" stroke="black" d="M320.072,-18.5C330.39,-18.5 343.79,-18.5 355.614,-18.5" />
<polygon fill="black" stroke="black" points="355.896,-22.0001 365.896,-18.5 355.896,-15.0001 355.896,-22.0001" />
<text text-anchor="middle" x="343" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q8&#45;&gt;q8 -->
<g id="edge5" class="edge"><title>q8&#45;&gt;q8</title>
<path fill="none" stroke="black" d="M294.969,-35.1641C293.406,-45.125 295.75,-54.5 302,-54.5 306.004,-54.5 308.405,-50.6525 309.202,-45.2682" />
<polygon fill="black" stroke="black" points="312.7,-45.1033 309.031,-35.1641 305.701,-45.2219 312.7,-45.1033" />
<text text-anchor="middle" x="302" y="-58.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: NFA union of DFAs 1 and 2 Pages: 1 -->
<svg role="img" aria-label="NFA union of DFAs 1 and 2" width="411pt" height="166pt" viewBox="0.00 0.00 411.00 166.00">
<title>NFA union of DFAs 1 and 2</title>
<desc>digraph &quot;NFA union of DFAs 1 and 2&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q4 [shape=doublecircle, width=0.4];
start -&gt; q0;
q0 -&gt; q1 [label=&quot;1&quot;];
q1 -&gt; q2 [label=&quot;0&quot;];
q2 -&gt; q3 [label=&quot;0&quot;];
q3 -&gt; q3 [label=&quot;0&quot;];
q3 -&gt; q4 [label=&quot;1&quot;];
q4 -&gt; q4 [label=&quot;1&quot;];
q9 [shape=doublecircle, width=0.4];
q0 -&gt; q6 [label=&quot;0&quot;];
q6 -&gt; q7 [label=&quot;1&quot;];
q7 -&gt; q8 [label=&quot;0&quot;];
q8 -&gt; q8 [label=&quot;0&quot;];
q8 -&gt; q9 [label=&quot;1&quot;];
q9 -&gt; q9 [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 162)">
<title>NFA union of DFAs 1 and 2</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q0 -->
<g id="node3" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="56" cy="-68.5" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-64.8" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- start&#45;&gt;q0 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M18.6816,-68.5C21.5653,-68.5 24.6106,-68.5 27.6617,-68.5" />
<polygon fill="black" stroke="black" points="27.8306,-72.0001 37.8306,-68.5 27.8306,-65.0001 27.8306,-72.0001" />
</g>
<!-- q4 -->
<g id="node2" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="384.5" cy="-106.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="384.5" cy="-106.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="384.5" y="-102.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q4&#45;&gt;q4 -->
<g id="edge7" class="edge"><title>q4&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M377.412,-123.774C375.965,-133.731 378.328,-143 384.5,-143 388.454,-143 390.844,-139.196 391.672,-133.844" />
<polygon fill="black" stroke="black" points="395.171,-133.744 391.588,-123.774 388.171,-133.803 395.171,-133.744" />
<text text-anchor="middle" x="384.5" y="-146.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1 -->
<g id="node4" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="138" cy="-93.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-89.8" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge2" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M73.5761,-73.68C84.3741,-77.0544 98.6885,-81.5276 110.985,-85.3704" />
<polygon fill="black" stroke="black" points="110.13,-88.77 120.719,-88.4122 112.218,-82.0887 110.13,-88.77" />
<text text-anchor="middle" x="97" y="-85.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q6 -->
<g id="node8" class="node"><title>q6</title>
<ellipse fill="none" stroke="black" cx="138" cy="-39.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-35.8" font-family="Times,serif" font-size="14.00">q6</text>
</g>
<!-- q0&#45;&gt;q6 -->
<g id="edge8" class="edge"><title>q0&#45;&gt;q6</title>
<path fill="none" stroke="black" d="M73.1892,-62.6314C84.1411,-58.6614 98.8373,-53.334 111.365,-48.7926" />
<polygon fill="black" stroke="black" points="112.626,-52.0584 120.835,-45.3599 110.241,-45.4774 112.626,-52.0584" />
<text text-anchor="middle" x="97" y="-59.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q2 -->
<g id="node5" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="220" cy="-94.5" rx="18" ry="18" />
<text text-anchor="middle" x="220" y="-90.8" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge3" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M156.359,-93.717C166.703,-93.8463 180.059,-94.0132 191.779,-94.1597" />
<polygon fill="black" stroke="black" points="191.907,-97.6615 201.95,-94.2869 191.994,-90.6621 191.907,-97.6615" />
<text text-anchor="middle" x="179" y="-97.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q3 -->
<g id="node6" class="node"><title>q3</title>
<ellipse fill="none" stroke="black" cx="302" cy="-105.5" rx="18" ry="18" />
<text text-anchor="middle" x="302" y="-101.8" font-family="Times,serif" font-size="14.00">q3</text>
</g>
<!-- q2&#45;&gt;q3 -->
<g id="edge4" class="edge"><title>q2&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M237.966,-96.8328C248.466,-98.2766 262.179,-100.162 274.132,-101.806" />
<polygon fill="black" stroke="black" points="273.675,-105.276 284.059,-103.171 274.629,-98.3409 273.675,-105.276" />
<text text-anchor="middle" x="261" y="-104.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q3&#45;&gt;q4 -->
<g id="edge6" class="edge"><title>q3&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M320.072,-105.712C330.39,-105.84 343.79,-106.007 355.614,-106.154" />
<polygon fill="black" stroke="black" points="355.853,-109.657 365.896,-106.281 355.94,-102.657 355.853,-109.657" />
<text text-anchor="middle" x="343" y="-109.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q3&#45;&gt;q3 -->
<g id="edge5" class="edge"><title>q3&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M294.969,-122.164C293.406,-132.125 295.75,-141.5 302,-141.5 306.004,-141.5 308.405,-137.652 309.202,-132.268" />
<polygon fill="black" stroke="black" points="312.7,-132.103 309.031,-122.164 305.701,-132.222 312.7,-132.103" />
<text text-anchor="middle" x="302" y="-145.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q9 -->
<g id="node7" class="node"><title>q9</title>
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="384.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="384.5" y="-14.8" font-family="Times,serif" font-size="14.00">q9</text>
</g>
<!-- q9&#45;&gt;q9 -->
<g id="edge13" class="edge"><title>q9&#45;&gt;q9</title>
<path fill="none" stroke="black" d="M377.412,-35.7739C375.965,-45.7309 378.328,-55 384.5,-55 388.454,-55 390.844,-51.196 391.672,-45.844" />
<polygon fill="black" stroke="black" points="395.171,-45.7445 391.588,-35.7739 388.171,-45.8027 395.171,-45.7445" />
<text text-anchor="middle" x="384.5" y="-58.8" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q7 -->
<g id="node9" class="node"><title>q7</title>
<ellipse fill="none" stroke="black" cx="220" cy="-38.5" rx="18" ry="18" />
<text text-anchor="middle" x="220" y="-34.8" font-family="Times,serif" font-size="14.00">q7</text>
</g>
<!-- q6&#45;&gt;q7 -->
<g id="edge9" class="edge"><title>q6&#45;&gt;q7</title>
<path fill="none" stroke="black" d="M156.359,-39.283C166.703,-39.1537 180.059,-38.9868 191.779,-38.8403" />
<polygon fill="black" stroke="black" points="191.994,-42.3379 201.95,-38.7131 191.907,-35.3385 191.994,-42.3379" />
<text text-anchor="middle" x="179" y="-42.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q8 -->
<g id="node10" class="node"><title>q8</title>
<ellipse fill="none" stroke="black" cx="302" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="302" y="-14.8" font-family="Times,serif" font-size="14.00">q8</text>
</g>
<!-- q7&#45;&gt;q8 -->
<g id="edge10" class="edge"><title>q7&#45;&gt;q8</title>
<path fill="none" stroke="black" d="M237.576,-34.356C248.303,-31.6744 262.499,-28.1252 274.741,-25.0648" />
<polygon fill="black" stroke="black" points="275.593,-28.4596 284.445,-22.6387 273.895,-21.6686 275.593,-28.4596" />
<text text-anchor="middle" x="261" y="-33.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q8&#45;&gt;q9 -->
<g id="edge12" class="edge"><title>q8&#45;&gt;q9</title>
<path fill="none" stroke="black" d="M320.072,-18.5C330.39,-18.5 343.79,-18.5 355.614,-18.5" />
<polygon fill="black" stroke="black" points="355.896,-22.0001 365.896,-18.5 355.896,-15.0001 355.896,-22.0001" />
<text text-anchor="middle" x="343" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q8&#45;&gt;q8 -->
<g id="edge11" class="edge"><title>q8&#45;&gt;q8</title>
<path fill="none" stroke="black" d="M294.969,-35.1641C293.406,-45.125 295.75,-54.5 302,-54.5 306.004,-54.5 308.405,-50.6525 309.202,-45.2682" />
<polygon fill="black" stroke="black" points="312.7,-45.1033 309.031,-35.1641 305.701,-45.2219 312.7,-45.1033" />
<text text-anchor="middle" x="302" y="-58.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>Cool. It works. But not in the general case! When there are edges going back to one of the start states, you get a mess. Say you have:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Binary string DFA 3 Pages: 1 -->
<svg role="img" aria-label="Binary string DFA 3" width="247pt" height="47pt" viewBox="0.00 0.00 247.00 46.88">
<title>Binary string DFA 3</title>
<desc>digraph &quot;Binary string DFA 3&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q2 [shape=doublecircle, width=0.4];
start -&gt; q0;
q0 -&gt; q1 [label=&quot;0&quot;];
q1 -&gt; q0 [label=&quot;0&quot;];
q1 -&gt; q2 [label=&quot;1&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 42.8775)">
<title>Binary string DFA 3</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q0 -->
<g id="node3" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="56" cy="-20.3775" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-16.6775" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- start&#45;&gt;q0 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M18.6816,-20.3775C21.5653,-20.3775 24.6106,-20.3775 27.6617,-20.3775" />
<polygon fill="black" stroke="black" points="27.8306,-23.8776 37.8306,-20.3775 27.8306,-16.8776 27.8306,-23.8776" />
</g>
<!-- q2 -->
<g id="node2" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="220.5" cy="-20.3775" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="220.5" cy="-20.3775" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="220.5" y="-16.6775" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q1 -->
<g id="node4" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="138" cy="-20.3775" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-16.6775" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge2" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M74.3588,-20.3775C84.7029,-20.3775 98.059,-20.3775 109.779,-20.3775" />
<polygon fill="black" stroke="black" points="109.95,-23.8776 119.95,-20.3775 109.95,-16.8776 109.95,-23.8776" />
<text text-anchor="middle" x="97" y="-24.1775" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge4" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M156.072,-20.3775C166.39,-20.3775 179.79,-20.3775 191.614,-20.3775" />
<polygon fill="black" stroke="black" points="191.896,-23.8776 201.896,-20.3775 191.896,-16.8776 191.896,-23.8776" />
<text text-anchor="middle" x="179" y="-24.1775" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q0 -->
<g id="edge3" class="edge"><title>q1&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M123.191,-9.38353C114.475,-3.76009 102.85,1.37752 92,-1.37752 88.042,-2.38255 84.0474,-3.93518 80.2436,-5.72923" />
<polygon fill="black" stroke="black" points="78.4751,-2.70597 71.3113,-10.5118 81.7793,-8.87708 78.4751,-2.70597" />
<text text-anchor="middle" x="97" y="-5.17752" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>Odd number of zeroes, then a one, that’s the language. And the other is:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: Binary string DFA 4 Pages: 1 -->
<svg role="img" aria-label="Binary string DFA 4" width="247pt" height="45pt" viewBox="0.00 0.00 247.00 45.00">
<title>Binary string DFA 4</title>
<desc>digraph &quot;Binary string DFA 4&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q5 [shape=doublecircle, width=0.4];
start -&gt; q3;
q3 -&gt; q4 [label=&quot;1&quot;];
q4 -&gt; q5 [label=&quot;0&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 41)">
<title>Binary string DFA 4</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q3 -->
<g id="node3" class="node"><title>q3</title>
<ellipse fill="none" stroke="black" cx="56" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-14.8" font-family="Times,serif" font-size="14.00">q3</text>
</g>
<!-- start&#45;&gt;q3 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M18.6816,-18.5C21.5653,-18.5 24.6106,-18.5 27.6617,-18.5" />
<polygon fill="black" stroke="black" points="27.8306,-22.0001 37.8306,-18.5 27.8306,-15.0001 27.8306,-22.0001" />
</g>
<!-- q5 -->
<g id="node2" class="node"><title>q5</title>
<ellipse fill="none" stroke="black" cx="220.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="220.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="220.5" y="-14.8" font-family="Times,serif" font-size="14.00">q5</text>
</g>
<!-- q4 -->
<g id="node4" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="138" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-14.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q3&#45;&gt;q4 -->
<g id="edge2" class="edge"><title>q3&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M74.3588,-18.5C84.7029,-18.5 98.059,-18.5 109.779,-18.5" />
<polygon fill="black" stroke="black" points="109.95,-22.0001 119.95,-18.5 109.95,-15.0001 109.95,-22.0001" />
<text text-anchor="middle" x="97" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q4&#45;&gt;q5 -->
<g id="edge3" class="edge"><title>q4&#45;&gt;q5</title>
<path fill="none" stroke="black" d="M156.072,-18.5C166.39,-18.5 179.79,-18.5 191.614,-18.5" />
<polygon fill="black" stroke="black" points="191.896,-22.0001 201.896,-18.5 191.896,-15.0001 191.896,-22.0001" />
<text text-anchor="middle" x="179" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>Single word language: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>{</mo><mn>1</mn><mn>0</mn><mo>}</mo></mrow><annotation encoding="application/x-tex">\{10\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">{</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span><span class="mclose">}</span></span></span></span></p>

<p>Now we merge the start states naively as before:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: (wrong) NFA union of DFAs 3 and 4 Pages: 1 -->
<svg role="img" aria-label="(wrong) NFA union of DFAs 3 and 4" width="247pt" height="110pt" viewBox="0.00 0.00 247.00 110.00">
<title>(wrong) NFA union of DFAs 3 and 4</title>
<desc>digraph &quot;(wrong) NFA union of DFAs 3 and 4&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q2 [shape=doublecircle, width=0.4];
start -&gt; q0;
q0 -&gt; q1 [label=&quot;0&quot;];
q1 -&gt; q0 [label=&quot;0&quot;];
q1 -&gt; q2 [label=&quot;1&quot;];
q5 [shape=doublecircle, width=0.4];
q0 -&gt; q4 [label=&quot;1&quot;];
q4 -&gt; q5 [label=&quot;0&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 106)">
<title>(wrong) NFA union of DFAs 3 and 4</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q0 -->
<g id="node3" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="56" cy="-56.5" rx="18" ry="18" />
<text text-anchor="middle" x="56" y="-52.8" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- start&#45;&gt;q0 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M18.6816,-56.5C21.5653,-56.5 24.6106,-56.5 27.6617,-56.5" />
<polygon fill="black" stroke="black" points="27.8306,-60.0001 37.8306,-56.5 27.8306,-53.0001 27.8306,-60.0001" />
</g>
<!-- q2 -->
<g id="node2" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="220.5" cy="-83.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="220.5" cy="-83.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="220.5" y="-79.8" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q1 -->
<g id="node4" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="138" cy="-83.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-79.8" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge2" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M72.4221,-64.3127C78.429,-67.1524 85.4361,-70.2204 92,-72.5 97.8405,-74.5284 104.231,-76.3304 110.315,-77.8593" />
<polygon fill="black" stroke="black" points="109.576,-81.281 120.112,-80.1658 111.181,-74.4673 109.576,-81.281" />
<text text-anchor="middle" x="97" y="-79.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q4 -->
<g id="node6" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="138" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="138" y="-14.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q0&#45;&gt;q4 -->
<g id="edge5" class="edge"><title>q0&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M70.2869,-45.3804C76.5588,-40.5716 84.3375,-35.2084 92,-31.5 97.7209,-28.7313 104.143,-26.4414 110.305,-24.5961" />
<polygon fill="black" stroke="black" points="111.52,-27.8934 120.259,-21.9043 109.692,-21.1361 111.52,-27.8934" />
<text text-anchor="middle" x="97" y="-35.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge4" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M156.072,-83.5C166.39,-83.5 179.79,-83.5 191.614,-83.5" />
<polygon fill="black" stroke="black" points="191.896,-87.0001 201.896,-83.5 191.896,-80.0001 191.896,-87.0001" />
<text text-anchor="middle" x="179" y="-87.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q0 -->
<g id="edge3" class="edge"><title>q1&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M125.797,-70.2305C119.535,-63.8596 111.157,-56.8875 102,-53.5 96.2606,-51.3769 89.8314,-50.8297 83.6684,-51.0942" />
<polygon fill="black" stroke="black" points="83.2825,-47.6154 73.7169,-52.1705 84.0353,-54.5748 83.2825,-47.6154" />
<text text-anchor="middle" x="97" y="-57.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q5 -->
<g id="node5" class="node"><title>q5</title>
<ellipse fill="none" stroke="black" cx="220.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="220.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="220.5" y="-14.8" font-family="Times,serif" font-size="14.00">q5</text>
</g>
<!-- q4&#45;&gt;q5 -->
<g id="edge6" class="edge"><title>q4&#45;&gt;q5</title>
<path fill="none" stroke="black" d="M156.072,-18.5C166.39,-18.5 179.79,-18.5 191.614,-18.5" />
<polygon fill="black" stroke="black" points="191.896,-22.0001 201.896,-18.5 191.896,-15.0001 191.896,-22.0001" />
<text text-anchor="middle" x="179" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>Now suddenly <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mn>0</mn><mn>1</mn><mn>0</mn></mrow><annotation encoding="application/x-tex">0010</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">0</span><span class="mord mathrm">0</span><span class="mord mathrm">1</span><span class="mord mathrm">0</span></span></span></span> is in the combined language, but it wasn’t in either of the originals. So that’s not a proper union operation. To fix this, we’ll use an extension of NFAs.</p>

<h3 id="nfa-span-classkatexspan-classkatex-mathmlmathsemanticsmrowmimimrowannotation-encodingapplicationx-texvarepsilonannotationsemanticsmathspanspan-classkatex-html-aria-hiddentruespan-classstrut-styleheight043056emspanspan-classstrut-bottom-styleheight043056emvertical-align0emspanspan-classbase-textstyle-uncrampedspan-classmord-mathitspanspanspanspan">NFA-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">ε</span></span></span></span></h3>

<p>A simple way to specify the correct union operation is through epsilon transitions. You add a new start state and epsilon transitions to the start states of the automata you want to union:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: (correct) NFA&#45;e union of DFAs 3 and 4 Pages: 1 -->
<svg role="img" aria-label="(correct) NFA-e union of DFAs 3 and 4" width="335pt" height="114pt" viewBox="0.00 0.00 335.00 114.00">
<title>(correct) NFA-e union of DFAs 3 and 4</title>
<desc>digraph &quot;(correct) NFA-e union of DFAs 3 and 4&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q2 [shape=doublecircle, width=0.4];
start -&gt; q00;
q00 -&gt; q0 [label=&quot;ε&quot;];
q00 -&gt; q3 [label=&quot;ε&quot;];
q0 -&gt; q1 [label=&quot;0&quot;];
q1 -&gt; q0 [label=&quot;0&quot;];
q1 -&gt; q2 [label=&quot;1&quot;];
q5 [shape=doublecircle, width=0.4];
q3 -&gt; q4 [label=&quot;1&quot;];
q4 -&gt; q5 [label=&quot;0&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 110)">
<title>(correct) NFA&#45;e union of DFAs 3 and 4</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q00 -->
<g id="node3" class="node"><title>q00</title>
<ellipse fill="none" stroke="black" cx="60" cy="-47.5" rx="18" ry="18" />
<text text-anchor="middle" x="60" y="-43.8" font-family="Times,serif" font-size="14.00">q00</text>
</g>
<!-- start&#45;&gt;q00 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q00</title>
<path fill="none" stroke="black" d="M18.7171,-47.5C22.8397,-47.5 27.3227,-47.5 31.751,-47.5" />
<polygon fill="black" stroke="black" points="31.7895,-51.0001 41.7894,-47.5 31.7894,-44.0001 31.7895,-51.0001" />
</g>
<!-- q2 -->
<g id="node2" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="308.5" cy="-87.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="308.5" cy="-87.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="308.5" y="-83.8" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q0 -->
<g id="node4" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="144" cy="-72.5" rx="18" ry="18" />
<text text-anchor="middle" x="144" y="-68.8" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- q00&#45;&gt;q0 -->
<g id="edge2" class="edge"><title>q00&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M77.5939,-52.5591C88.8196,-55.9816 103.883,-60.5741 116.724,-64.4892" />
<polygon fill="black" stroke="black" points="115.845,-67.8799 126.431,-67.4484 117.886,-61.1842 115.845,-67.8799" />
<text text-anchor="middle" x="104" y="-64.3" font-family="Times,serif" font-size="14.00">ε</text>
</g>
<!-- q3 -->
<g id="node5" class="node"><title>q3</title>
<ellipse fill="none" stroke="black" cx="144" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="144" y="-14.8" font-family="Times,serif" font-size="14.00">q3</text>
</g>
<!-- q00&#45;&gt;q3 -->
<g id="edge3" class="edge"><title>q00&#45;&gt;q3</title>
<path fill="none" stroke="black" d="M77.2006,-41.7705C88.6562,-37.7191 104.249,-32.2045 117.381,-27.5605" />
<polygon fill="black" stroke="black" points="118.572,-30.8516 126.833,-24.2176 116.238,-24.2521 118.572,-30.8516" />
<text text-anchor="middle" x="104" y="-36.3" font-family="Times,serif" font-size="14.00">ε</text>
</g>
<!-- q1 -->
<g id="node6" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="226" cy="-87.5" rx="18" ry="18" />
<text text-anchor="middle" x="226" y="-83.8" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge4" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M161.684,-76.5655C167.466,-77.9072 174.001,-79.3493 180,-80.5 185.727,-81.5985 191.888,-82.645 197.759,-83.5783" />
<polygon fill="black" stroke="black" points="197.442,-87.0704 207.856,-85.1228 198.501,-80.1509 197.442,-87.0704" />
<text text-anchor="middle" x="185" y="-85.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q4 -->
<g id="node8" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="226" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="226" y="-14.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q3&#45;&gt;q4 -->
<g id="edge7" class="edge"><title>q3&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M162.359,-18.5C172.703,-18.5 186.059,-18.5 197.779,-18.5" />
<polygon fill="black" stroke="black" points="197.95,-22.0001 207.95,-18.5 197.95,-15.0001 197.95,-22.0001" />
<text text-anchor="middle" x="185" y="-22.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge6" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M244.072,-87.5C254.39,-87.5 267.79,-87.5 279.614,-87.5" />
<polygon fill="black" stroke="black" points="279.896,-91.0001 289.896,-87.5 279.896,-84.0001 279.896,-91.0001" />
<text text-anchor="middle" x="267" y="-91.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q0 -->
<g id="edge5" class="edge"><title>q1&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M212.526,-75.1514C206.304,-69.8545 198.336,-64.2576 190,-61.5 183.586,-59.3784 176.536,-59.8334 169.959,-61.4025" />
<polygon fill="black" stroke="black" points="168.603,-58.1624 160.17,-64.5753 170.762,-64.8214 168.603,-58.1624" />
<text text-anchor="middle" x="185" y="-65.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q5 -->
<g id="node7" class="node"><title>q5</title>
<ellipse fill="none" stroke="black" cx="308.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="308.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="308.5" y="-14.8" font-family="Times,serif" font-size="14.00">q5</text>
</g>
<!-- q4&#45;&gt;q5 -->
<g id="edge8" class="edge"><title>q4&#45;&gt;q5</title>
<path fill="none" stroke="black" d="M244.072,-18.5C254.39,-18.5 267.79,-18.5 279.614,-18.5" />
<polygon fill="black" stroke="black" points="279.896,-22.0001 289.896,-18.5 279.896,-15.0001 279.896,-22.0001" />
<text text-anchor="middle" x="267" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>If you remember my <a href="/compsci/2016/04/10/finite-automata/#epsilon-moves">first finite automata post</a> you may be reminded of the regex “or” (<code class="highlighter-rouge">|</code>) operator, which is exactly the same as this union of the underlying sets. The epsilon means you can take the transition “for free” without consuming any input. So it comes down to having a new start states that has the out-transitions of the all the old start states:</p>

<div class="graphviz-wrapper">

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: (correct) NFA&#45;e union of DFAs 3 and 4 Pages: 1 -->
<svg role="img" aria-label="(correct) NFA-e union of DFAs 3 and 4" width="255pt" height="159pt" viewBox="0.00 0.00 255.00 159.00">
<title>(correct) NFA-e union of DFAs 3 and 4</title>
<desc>digraph &quot;(correct) NFA-e union of DFAs 3 and 4&quot; { 
bgcolor=&quot;transparent&quot;;
rankdir=LR;
node [shape=circle, fixedsize=shape, width=0.5];
start [shape=none, label=&quot;&quot;, width=0];
q2 [shape=doublecircle, width=0.4];
q3 [color=grey, fontcolor=grey];
start -&gt; q00;
q00 -&gt; q1 [label=&quot;0&quot;];
q00 -&gt; q4 [label=&quot;1&quot;];
q0 -&gt; q1 [label=&quot;0&quot;];
q1 -&gt; q0 [label=&quot;0&quot;];
q1 -&gt; q2 [label=&quot;1&quot;];
q5 [shape=doublecircle, width=0.4];
q3 -&gt; q4 [label=&quot;1&quot;, color=grey, fontcolor=grey];
q4 -&gt; q5 [label=&quot;0&quot;];
 }</desc>

<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 155)">
<title>(correct) NFA&#45;e union of DFAs 3 and 4</title>
<!-- start -->
<g id="node1" class="node"><title>start</title>
</g>
<!-- q00 -->
<g id="node4" class="node"><title>q00</title>
<ellipse fill="none" stroke="black" cx="60" cy="-83.5" rx="18" ry="18" />
<text text-anchor="middle" x="60" y="-79.8" font-family="Times,serif" font-size="14.00">q00</text>
</g>
<!-- start&#45;&gt;q00 -->
<g id="edge1" class="edge"><title>start&#45;&gt;q00</title>
<path fill="none" stroke="black" d="M18.7171,-83.5C22.8397,-83.5 27.3227,-83.5 31.751,-83.5" />
<polygon fill="black" stroke="black" points="31.7895,-87.0001 41.7894,-83.5 31.7894,-80.0001 31.7895,-87.0001" />
</g>
<!-- q2 -->
<g id="node2" class="node"><title>q2</title>
<ellipse fill="none" stroke="black" cx="228.5" cy="-132.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="228.5" cy="-132.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="228.5" y="-128.8" font-family="Times,serif" font-size="14.00">q2</text>
</g>
<!-- q3 -->
<g id="node3" class="node"><title>q3</title>
<ellipse fill="none" stroke="grey" cx="60" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="60" y="-14.8" font-family="Times,serif" font-size="14.00" fill="grey">q3</text>
</g>
<!-- q4 -->
<g id="node6" class="node"><title>q4</title>
<ellipse fill="none" stroke="black" cx="146" cy="-18.5" rx="18" ry="18" />
<text text-anchor="middle" x="146" y="-14.8" font-family="Times,serif" font-size="14.00">q4</text>
</g>
<!-- q3&#45;&gt;q4 -->
<g id="edge7" class="edge"><title>q3&#45;&gt;q4</title>
<path fill="none" stroke="grey" d="M78.4049,-18.5C89.7428,-18.5 104.773,-18.5 117.685,-18.5" />
<polygon fill="grey" stroke="grey" points="117.905,-22.0001 127.905,-18.5 117.905,-15.0001 117.905,-22.0001" />
<text text-anchor="middle" x="105" y="-22.3" font-family="Times,serif" font-size="14.00" fill="grey">1</text>
</g>
<!-- q1 -->
<g id="node5" class="node"><title>q1</title>
<ellipse fill="none" stroke="black" cx="146" cy="-94.5" rx="18" ry="18" />
<text text-anchor="middle" x="146" y="-90.8" font-family="Times,serif" font-size="14.00">q1</text>
</g>
<!-- q00&#45;&gt;q1 -->
<g id="edge2" class="edge"><title>q00&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M77.9987,-85.726C89.4982,-87.2319 104.929,-89.2526 118.084,-90.9752" />
<polygon fill="black" stroke="black" points="117.657,-94.4491 128.027,-92.2773 118.566,-87.5084 117.657,-94.4491" />
<text text-anchor="middle" x="105" y="-94.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q00&#45;&gt;q4 -->
<g id="edge3" class="edge"><title>q00&#45;&gt;q4</title>
<path fill="none" stroke="black" d="M74.8709,-72.7666C88.0815,-62.5441 108.164,-47.0043 123.457,-35.1699" />
<polygon fill="black" stroke="black" points="125.62,-37.9216 131.387,-29.0337 121.337,-32.3855 125.62,-37.9216" />
<text text-anchor="middle" x="105" y="-57.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q1&#45;&gt;q2 -->
<g id="edge6" class="edge"><title>q1&#45;&gt;q2</title>
<path fill="none" stroke="black" d="M162.521,-101.827C173.735,-107.12 189.129,-114.387 202.12,-120.519" />
<polygon fill="black" stroke="black" points="200.938,-123.832 211.475,-124.936 203.926,-117.502 200.938,-123.832" />
<text text-anchor="middle" x="187" y="-119.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- q0 -->
<g id="node7" class="node"><title>q0</title>
<ellipse fill="none" stroke="black" cx="228.5" cy="-75.5" rx="18" ry="18" />
<text text-anchor="middle" x="228.5" y="-71.8" font-family="Times,serif" font-size="14.00">q0</text>
</g>
<!-- q1&#45;&gt;q0 -->
<g id="edge5" class="edge"><title>q1&#45;&gt;q0</title>
<path fill="none" stroke="black" d="M163.68,-90.5632C174.473,-88.0156 188.758,-84.644 201.077,-81.7365" />
<polygon fill="black" stroke="black" points="201.913,-85.1354 210.842,-79.4318 200.305,-78.3226 201.913,-85.1354" />
<text text-anchor="middle" x="187" y="-90.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q5 -->
<g id="node8" class="node"><title>q5</title>
<ellipse fill="none" stroke="black" cx="228.5" cy="-18.5" rx="14.5" ry="14.5" />
<ellipse fill="none" stroke="black" cx="228.5" cy="-18.5" rx="18.5" ry="18.5" />
<text text-anchor="middle" x="228.5" y="-14.8" font-family="Times,serif" font-size="14.00">q5</text>
</g>
<!-- q4&#45;&gt;q5 -->
<g id="edge8" class="edge"><title>q4&#45;&gt;q5</title>
<path fill="none" stroke="black" d="M164.072,-18.5C174.39,-18.5 187.79,-18.5 199.614,-18.5" />
<polygon fill="black" stroke="black" points="199.896,-22.0001 209.896,-18.5 199.896,-15.0001 199.896,-22.0001" />
<text text-anchor="middle" x="187" y="-22.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
<!-- q0&#45;&gt;q1 -->
<g id="edge4" class="edge"><title>q0&#45;&gt;q1</title>
<path fill="none" stroke="black" d="M213.875,-64.3309C204.789,-58.2967 192.611,-52.931 182,-57.5 174.742,-60.6253 168.285,-66.0782 162.956,-71.8525" />
<polygon fill="black" stroke="black" points="160.106,-69.8055 156.417,-79.7373 165.495,-74.2739 160.106,-69.8055" />
<text text-anchor="middle" x="187" y="-61.3" font-family="Times,serif" font-size="14.00">0</text>
</g>
</g>
</svg>
</div>

<p>This is a perfectly valid thing to do directly instead of going via epsilon transitions and doing using the epsilon-closure operation to turn the NFA-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">ε</span></span></span></span> into a normal NFA. But at work a friend (Daniël) mentioned that I didn’t go into epsilon closure in my last post, and that it’s surprisingly hard to implement (efficiently anyway), so this time we’ll look at this epsilon-closure.</p>

<h1 id="the-elusive-epsilon-closure">The elusive epsilon closure</h1>

<p>So we have an NFA-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">ε</span></span></span></span> and we want a normal NFA. That means we need to copy the out-transitions of other nodes reachable by epsilon transition. Seems pretty simple right? Let’s do that (naively), with some adapted data definitions from last post:</p>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code><span class="c">// This should look familiar :)</span>
<span class="cp">#[derive(Clone)]</span>
<span class="k">struct</span> <span class="n">NFAHashState</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">StateRef</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">transitions</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">StateRef</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Payload</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="cp">#[derive(Clone)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">FiniteAutomaton</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">State</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">alphabet</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">states</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">State</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">NFA</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">FiniteAutomaton</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">NFAHashState</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">NFAE</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">FiniteAutomaton</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">NFAHashState</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Input</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">NFAE</code> is our augmented NFA, which can have a transition on <code class="highlighter-rouge">None</code> (the epsilon move) or on <code class="highlighter-rouge">Some(input)</code> (the normal transition). Although not quite accurate, we’ll name our <code class="highlighter-rouge">NFAE -&gt; NFA</code> operation <code class="highlighter-rouge">epsilon_closure</code>. I’m going to give you some <strong>wrong</strong> code that’s simple for the first iteration:</p>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code><span class="k">impl</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">:</span> <span class="nb">Eq</span> <span class="o">+</span> <span class="n">Hash</span> <span class="o">+</span> <span class="n">Clone</span><span class="p">,</span> <span class="n">Payload</span><span class="p">:</span> <span class="n">Clone</span><span class="o">&gt;</span> <span class="n">NFAE</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">naive_epsilon_closure</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">NFA</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">epsilons</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">HashSet</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="k">self</span><span class="py">.states</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">st</span><span class="p">|</span> <span class="n">st</span><span class="py">.transitions</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">None</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.unwrap_or_else</span><span class="p">(</span><span class="nn">HashSet</span><span class="p">::</span><span class="n">new</span><span class="p">))</span>
            <span class="nf">.collect</span><span class="p">();</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">states</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">NFAHashState</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="k">self</span><span class="py">.states</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">st</span><span class="p">|</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">transitions</span> <span class="o">=</span> <span class="n">st</span><span class="py">.transitions</span>
                    <span class="nf">.iter</span><span class="p">()</span>
                    <span class="nf">.filter_map</span><span class="p">(|(</span><span class="n">inp</span><span class="p">,</span> <span class="n">st_ref</span><span class="p">)|</span> <span class="n">inp</span><span class="nf">.clone</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="p">(</span><span class="n">k</span><span class="nf">.clone</span><span class="p">(),</span> <span class="n">st_ref</span><span class="nf">.clone</span><span class="p">())))</span>
                    <span class="nf">.collect</span><span class="p">();</span>
                <span class="nn">NFAHashState</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">transitions</span><span class="p">,</span> <span class="n">st</span><span class="py">.payload</span><span class="nf">.clone</span><span class="p">())</span>
            <span class="p">})</span>
            <span class="nf">.collect</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span> <span class="n">in</span> <span class="n">epsilons</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="o">&amp;</span><span class="n">e</span> <span class="n">in</span> <span class="n">eps</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">st_ref</span><span class="p">)</span> <span class="n">in</span> <span class="n">states</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="py">.transitions</span><span class="nf">.clone</span><span class="p">()</span> <span class="p">{</span>
                    <span class="n">states</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="py">.transitions</span><span class="nf">.entry</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span><span class="nf">.or_insert_with</span><span class="p">(</span><span class="nn">HashSet</span><span class="p">::</span><span class="n">new</span><span class="p">)</span><span class="nf">.extend</span><span class="p">(</span><span class="n">st_ref</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">NFA</span> <span class="p">{</span>
            <span class="n">alphabet</span><span class="p">:</span> <span class="k">self</span><span class="py">.alphabet</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="n">states</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I know, collecting the <code class="highlighter-rouge">states</code> and <code class="highlighter-rouge">epsilons</code> can be done in a single loop. I chose this form for readability, and the compiler might do loop fusion<sup id="fnref:loop-fusion"><a href="#fn:loop-fusion" class="footnote">1</a></sup>. Anyway, as you can see we just split up the normal transitions and epsilons. Then we copy over the normal transitions of a state the epsilon points to, to the origin of that epsilon. Easy peasy. Except, as I warned, it’s <strong>wrong</strong>.</p>

<h2 id="not-as-simple-as-that">Not as simple as that</h2>

<p>Epsilon transitions don’t consume any input. So you could as well take multiple before going over a “real” transition. This is what makes an epsilon closure a transitive closure. You can in principle reach more than one state away. That means that we could be doing extra work if we replace the epsilon transitions in an awkward order.</p>

<p>You may be thinking of dynamic programming, caching or topological order to fix this problem. But there’s another complication: cycles. Automata are just graphs, and cycles are allowed. An epsilon cycle basically means that the states in the cycle can be collapsed into one state. After all, they will all have the same out-transitions, so they’ll have the same behaviour.</p>

<p>So what I did is a Wikipedia search for a nice <a href="https://en.wikipedia.org/wiki/Reachability">transitive closure algorithm in graphs</a>. What I found when I did this was a <a href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm#Algorithm">surprisingly simple, kind of disappointing algorithm</a>. Here’s the TL;DR: It’s <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi mathvariant="normal">∣</mi><mi>V</mi><msup><mi mathvariant="normal">∣</mi><mn>3</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(|V|^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathrm">∣</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathrm">∣</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">3</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span></span></span></span>, uses an adjacency matrix and extends that matrix in triply nested loops over the vertices. Not very exciting, so I tried to figure something out myself. I went through multiple iterations here as you <a href="https://github.com/Apanatshka/dnfa/commit/730474af273a9f565e6f337561321a270a9c8b42">can</a> <a href="https://github.com/Apanatshka/dnfa/commit/0d22e1c1ce80df4cff952bf6259dfc110fd84650">see</a>, so wrong, some inelegant. I never got to the point of testing any of my implementations, because I’d discuss my progress at work with Daniël and I’d be motivated to find a nicer way to implement this thing.</p>

<h2 id="the-real-implementation">The real implementation</h2>

<p>So basically I was looking in the wrong direction while looking for an existing algorithm. My own implementation probably worked at some point but was quite inelegant, so I searched Wikipedia some different names. When you look at topological order instead of transitive closure, you’ll find the issue of cycles. But if you follow the link on cycles, you get to <a href="https://en.wikipedia.org/wiki/Strongly_connected_component">Strongly Connected Components</a>. A strongly connected component (SCC) is a bunch of nodes that can reach all others in the SCC. So without epsilon cycles all your NFAE states are their own component in the epsilon-transition subgraph. Then when you look at the classic algorithms for getting SCCs in a graph, you’ll find that <a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm">Tarjan’s algorithm for SCCs</a> gives back these SCCs in reverse topological order. Exactly what we need!</p>

<p>When I found this I felt kind of silly. But I <a href="https://github.com/Apanatshka/dnfa/commit/36bfaba5ded2a6784b811cb04056a1b50493f405">implemented the Tarjan’s SCC algorithm</a>, and it wasn’t very hard. So let’s walk through it. First, I moved the epsilon transition to a separate field in a new struct definition:</p>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code><span class="c">// Much nicer to work with really. Why did I not do this before?</span>
<span class="cp">#[derive(Clone)]</span>
<span class="k">struct</span> <span class="n">NFAEHashState</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">StateRef</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">transitions</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">StateRef</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="n">e_transition</span><span class="p">:</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">StateRef</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Payload</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Then we have the start up part of the algorithm:</p>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code>    <span class="c">/// This is an implementation of Tarjan's Strongly Connected Components algorithm. The nice</span>
    <span class="c">/// property of this SCC algorithm is that it gives the SCC's in reverse topological order.</span>
    <span class="k">fn</span> <span class="nf">scc</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">st_index</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[::</span><span class="nn">std</span><span class="p">::</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">;</span> <span class="k">self</span><span class="py">.states</span><span class="nf">.len</span><span class="p">()];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">st_lowlink</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[::</span><span class="nn">std</span><span class="p">::</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">;</span> <span class="k">self</span><span class="py">.states</span><span class="nf">.len</span><span class="p">()];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">scc_stack</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">stack_set</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">scc_s</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

        <span class="k">for</span> <span class="n">st_ref</span> <span class="n">in</span> <span class="mi">0</span><span class="err">.</span><span class="py">.self.states</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">st_index</span><span class="p">[</span><span class="n">st_ref</span><span class="p">]</span> <span class="o">==</span> <span class="p">::</span><span class="nn">std</span><span class="p">::</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.scc_strongconnect</span><span class="p">(</span><span class="n">st_ref</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">index</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">st_index</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">st_lowlink</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">scc_stack</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">stack_set</span><span class="p">,</span>
                                       <span class="o">&amp;</span><span class="k">mut</span> <span class="n">scc_s</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">(</span><span class="n">st_lowlink</span><span class="p">,</span> <span class="n">scc_s</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>In the end all this does is make sure we visit every node. We visit nodes with a depth-first search, that’s what <code class="highlighter-rouge">scc_strongconnect</code> is for:</p>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code>    <span class="k">fn</span> <span class="nf">scc_strongconnect</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span>
                         <span class="n">from</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
                         <span class="n">index</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">usize</span><span class="p">,</span>
                         <span class="n">st_index</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="p">[</span><span class="nb">usize</span><span class="p">],</span>
                         <span class="n">st_lowlink</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="p">[</span><span class="nb">usize</span><span class="p">],</span>
                         <span class="n">scc_stack</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
                         <span class="n">stack_set</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
                         <span class="n">scc_s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">st_index</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">index</span><span class="p">;</span>
        <span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">index</span><span class="p">;</span>
        <span class="o">*</span><span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="n">scc_stack</span><span class="nf">.push</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>
        <span class="n">stack_set</span><span class="nf">.insert</span><span class="p">(</span><span class="n">from</span><span class="p">);</span>

        <span class="k">for</span> <span class="o">&amp;</span><span class="n">to</span> <span class="n">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.states</span><span class="p">[</span><span class="n">from</span><span class="p">]</span><span class="py">.e_transition</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">st_index</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="p">::</span><span class="nn">std</span><span class="p">::</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.scc_strongconnect</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">st_index</span><span class="p">,</span> <span class="n">st_lowlink</span><span class="p">,</span> <span class="n">scc_stack</span><span class="p">,</span> <span class="n">stack_set</span><span class="p">,</span> <span class="n">scc_s</span><span class="p">);</span>
                <span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">=</span> <span class="p">::</span><span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="nf">min</span><span class="p">(</span><span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">],</span> <span class="n">st_lowlink</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">stack_set</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">to</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">=</span> <span class="p">::</span><span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="nf">min</span><span class="p">(</span><span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">],</span> <span class="n">st_index</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">st_lowlink</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="o">==</span> <span class="n">st_index</span><span class="p">[</span><span class="n">from</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">scc</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
            <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">st_ref</span><span class="p">)</span> <span class="o">=</span> <span class="n">scc_stack</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">stack_set</span><span class="nf">.remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st_ref</span><span class="p">);</span>
                <span class="n">scc</span><span class="nf">.push</span><span class="p">(</span><span class="n">st_ref</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">st_ref</span> <span class="o">==</span> <span class="n">from</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">scc_s</span><span class="nf">.push</span><span class="p">(</span><span class="n">scc</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<p>So the <code class="highlighter-rouge">index</code> is a simple counter, and <code class="highlighter-rouge">st_index</code> and <code class="highlighter-rouge">st_lowlink</code> get a value from when you visit a node. But the lowlink should eventually hold the lowest index you can reach. So after you visit the children (or if you’ve already visited them) you propagate a lower lowlink back with the <code class="highlighter-rouge">min</code> function. Now the <code class="highlighter-rouge">scc_stack</code> is not only useful for tracking what the DFS has visited so far, but also to track SCCs. Any state that has no outgoing epsilon transitions will just keep <code class="highlighter-rouge">st_lowlink[from] == st_index[from]</code> and therefore be an SCC on its own. So it gets popped off of <code class="highlighter-rouge">scc_stack</code> and pushed onto <code class="highlighter-rouge">scc_s</code>, the reverse topo order SCCs vector. If a state did have epsilon transitions but it’s children can’t reach anything with a lower index than this one, then all states on the <code class="highlighter-rouge">scc_stack</code> from here on are one SCC with <code class="highlighter-rouge">st_index[from]</code> as an identifying number. So pop them off of <code class="highlighter-rouge">scc_stack</code> and add the lot to <code class="highlighter-rouge">scc_s</code>.</p>

<p>If you can follow the code and my description of the algorithm, check out the <a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm#/media/File:Tarjan%27s_Algorithm_Animation.gif">gif on wikipedia</a>. Visual explanations ftw.</p>

<h3 id="using-the-sccshttpsgithubcomapanatshkadnfacommitc2463da9bc381a01fb1b09c9f989dcb90c56f50c"><a href="https://github.com/Apanatshka/dnfa/commit/c2463da9bc381a01fb1b09c9f989dcb90c56f50c">Using the SCCs</a></h3>

<div class="language-rust highlighter-rouge"><pre class="highlight"><code>    <span class="c">/// Replaces epsilon transitions with equivalent states/transitions</span>
    <span class="c">/// Cycles are replaced by single states</span>
    <span class="c">/// States that aren't reachable from `AUTO_START` are preserved (not by design)</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">to_nfa</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">NFA</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c">// The SCCs are in reverse topo order for optimal epsilon</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">sccs</span><span class="p">,</span> <span class="n">renumbering</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.scc</span><span class="p">();</span>
        <span class="c">// the new states</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">states</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">NFAHashState</span><span class="o">&lt;</span><span class="n">Input</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">Payload</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">sccs</span><span class="nf">.len</span><span class="p">());</span>

        <span class="k">for</span> <span class="n">scc</span> <span class="n">in</span> <span class="n">sccs</span> <span class="p">{</span>
            <span class="n">states</span><span class="p">[</span><span class="n">renumbering</span><span class="p">[</span><span class="n">scc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span>
                <span class="nn">Self</span><span class="p">::</span><span class="nf">scc_to_nfa_state</span><span class="p">(</span><span class="o">&amp;</span><span class="n">scc</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.states</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">renumbering</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">states</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">NFA</span> <span class="p">{</span>
            <span class="n">alphabet</span><span class="p">:</span> <span class="k">self</span><span class="py">.alphabet</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="n">states</span><span class="p">:</span> <span class="n">states</span><span class="p">,</span>
        <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>You may think: Is it really this tiny a function once you have the SCCs? But no, there is a helper function <code class="highlighter-rouge">scc_to_nfa_state</code> that’s a bit larger. It <em>is</em> this <strong>simple</strong> though. We can get not only the SCCs out of Tarjan’s algorithm in the desired reverse topo order, but we can also take the <code class="highlighter-rouge">st_lowlink</code> with. If we use it as a <code class="highlighter-rouge">renumbering</code> of the states, we’ll effectively merge all the epsilon loops with no extra effort! Of course the <code class="highlighter-rouge">scc_to_nfa_state</code> does need to collect all the extra transitions, but you can do that from the new NFA that you’re building because of the reverse topo order. So it’s really just <a href="https://github.com/Apanatshka/dnfa/blob/dfa16ae236fb21f5fdc6062c0496e18242f18c32/src/nfa.rs#L206-L236">30 lines of bookkeeping</a>, being careful to use the renumbered state index iff necessary.</p>

<h2 id="delremoving-the-recursiondel-insare-we-there-yetins"><del>Removing the recursion</del> <ins>Are we there yet?</ins></h2>

<p>Well.. Ok, let’s stop here. I had something more to write about removing the recursion from the depth-first search, but I’ll just link to it and not go into detail. My <a href="https://github.com/Apanatshka/dnfa/commit/d0ed9c2d2931f1fc62007c28bee8768abead3346">first attempt</a> was a bit hairy, but I managed to <a href="https://github.com/Apanatshka/dnfa/commit/cc4b5ad939882a8fa18e50371dbe90ee23f70bf1">refactor it</a> to something that I think is manageable. But it <em>is</em> more code, and not the clear algorithm is was anymore. So not as maintainable, and even though the algorithm will unlikely need any changes if it’s bug-free<sup id="fnref:bug-free"><a href="#fn:bug-free" class="footnote">2</a></sup>, it may still need to be edited if the NFAE data structure changes. In the end I’d rather see the compiler do magic to eliminate recursive function call overhead. If I can do it, and it feels mechanical (it kind of did), then a compiler should be able to do this too right? But it’s definitely non-trivial, so yeah.. Whatever ¯\_(ツ)_/¯</p>

<h1 id="footnotes">Footnotes</h1>

<div class="footnotes">
  <ol>
    <li id="fn:loop-fusion">
      <p>I have no idea how much the compiler can currently do in this regard. Nor whether a single loop is even better in this case. <a href="#fnref:loop-fusion" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:bug-free">
      <p>I’m so sorry, but I didn’t test any of the code in this blog post (or linked to in the post) <em>at all</em> O_O I’m a terrible person, I know. I thought of testing the code, but I was still exploring possible solutions. And I don’t trust unit tests to really cover the whole problem and they can be brittle with this data layout for NFAs. Ideally I’d write property-based test (<a href="https://crates.io/crates/quickcheck">quickcheck</a>), but that really requires extra code to normalise NFAs so structurally same NFAs have a unique representation. And I’d need to understand the problemspace fully to generate good input/output. So I thought of all this and I went “bleh, maybe later”. In retrospect I should have just written a few unit tests… <a href="#fnref:bug-free" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Whatever</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:jeff.smits@gmail.com">jeff.smits@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/Apanatshka">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">Apanatshka</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">A web log. Mostly about computer science-y stuff. 
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
